(function(){var e;module.exports=e=function(){function e(e,t,o){this.callback=o,this.cacheRef=e.child("cache"),this.cacheRef.on("value",function(e){return function(o){var n;return e.cacheRef.off(),n=o.val(),null==n&&(n=[]),e.feedsWithNewPosts=e.getFeedsWithNewPosts(t,n),e.feedsWithNewPosts.length>0&&(console.log("feeds with new posts"),console.log(e.feedsWithNewPosts)),e.updateCache(t)}}(this))}return e.prototype.getFeedsWithNewPosts=function(e,t){var o,n,s,c,r,i,l,h;for(s={},l=0,h=t.length;h>l;l++)o=t[l],s[o.feedUrl]=o.latestPostUrl;console.log("cache"),console.log(s),r={},i=function(e,t){var o,n,c,i;return o=s[e],i=t.clone(),n=function(){var e;for(e=[];(c=i.shift()).link!==o;)e.push(c);return e}(),n.length>0?r[e]=n:void 0};for(n in e)c=e[n],i(n,c);return r},e.prototype.updateCache=function(e){var t,o,n;t=[];for(n in e)o=e[n],t.push({feedUrl:n,latestPostUrl:o[0].link});return this.cacheRef.set(t,function(e){return function(t){return t?(console.log("error happened while saving cache"),process.exit(1)):e.callback(e.feedsWithNewPosts)}}(this))},e}()}).call(this);