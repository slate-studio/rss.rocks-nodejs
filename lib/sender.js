(function(){var n,r;n=require("postmark")(process.env.POSTMARK_API_KEY),module.exports=r=function(){function n(n,r,t){var e;this.users=n,e=this.generateEmails(r),e.length>0?this.sendEmails(e,t):(console.log("no emails to send"),t())}return n.prototype.sendEmails=function(n,r){var t;return t=_after(n.length,function(){return console.log(""+n.length+" emails sent"),r()}),n.map(function(n){return t()})},n.prototype.generateEmails=function(n){var r,t,e,o,i;r=[],i=this.users,o=function(t,e){var o,i,s,u;s=e.subscriptions,u=[];for(o in s)i=s[o],u.push(function(t,o){var i,s,u;return u=n[o.url],u?(i=function(){var n,r,t;for(t=[],n=0,r=u.length;r>n;n++)s=u[n],t.push({fromEmail:"",toEmail:e.email,subject:o.name,body:""+s.title+"\n"+s.link});return t}(),r.appendArray(i)):void 0}(o,i));return u};for(e in i)t=i[e],o(e,t);return r},n}()}).call(this);