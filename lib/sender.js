(function(){var n,e;n=require("postmark")(process.env.POSTMARK_API_KEY),module.exports=e=function(){function e(n,e,r){var t;this.users=n,t=this.generateEmails(e),t.length>0?this.sendEmails(t,r):(console.log("no emails to send"),r())}return e.prototype.sendEmails=function(e,r){var t;return t=_after(e.length,function(){return console.log(""+e.length+" emails sent"),r()}),n.batch(e,function(n,e){return n&&console.error("Unable to send via postmark: "+n.message),t()})},e.prototype.generateEmails=function(n){var e,r,t,o,s;e=[],s=this.users,o=function(r,t){var o,s,i,a;i=t.subscriptions,a=[];for(o in i)s=i[o],a.push(function(r,o){var s,i,a;return a=n[o.url],a?(s=function(){var n,e,r;for(r=[],n=0,e=a.length;e>n;n++)i=a[n],r.push({From:"service@kra.vc",To:t.email,Subject:o.name,TextBody:""+i.title+"\n"+i.link});return r}(),e.appendArray(s)):void 0}(o,s));return a};for(t in s)r=s[t],o(t,r);return e},e}()}).call(this);