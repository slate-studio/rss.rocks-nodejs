(function(){var n,t;n=require("postmark")(process.env.POSTMARK_API_KEY),module.exports=t=function(){function n(n,t,r){var e;this.users=n,e=this.generateEmails(t),e.length>0?this.sendEmails(e,r):(console.log("no emails to send"),r())}return n.prototype.sendEmails=function(n,t){var r;return r=_after(n.length,function(){return console.log(""+n.length+" emails sent"),t()}),n.map(function(n){return r()})},n.prototype.generateEmails=function(n){var t,r,e,o,i;t=[],i=this.users,o=function(r,e){var o,i,s,u;s=e.subscriptions,u=[];for(o in s)i=s[o],u.push(function(r,o){var i,s,u;return u=n[o.url],u?(i=function(){var n,t,r;for(r=[],n=0,t=u.length;t>n;n++)s=u[n],r.push({fromEmail:"",toEmail:e.email,subject:o.name,body:""+s.title+"\n"+s.link});return r}(),Array.prototype.push.apply(t,i)):void 0}(o,i));return u};for(e in i)r=i[e],o(e,r);return t},n}()}).call(this);