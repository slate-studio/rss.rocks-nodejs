(function(){var e,n;e=require("postmark")(process.env.POSTMARK_API_KEY),module.exports=n=function(){function n(e,n,r){var t;this.users=e,t=this.generateEmails(n),t.length>0?this.sendEmails(t,r):(console.log("no emails to send"),r())}return n.prototype.sendEmails=function(n,r){return e.batch(n,function(e,t){return e&&console.error("Unable to send via postmark: "+e.message),console.log(""+n.length+" emails sent"),r()})},n.prototype.generateEmails=function(e){var n,r,t,o,s;n=[],s=this.users,o=function(r,t){var o,s,i,a;i=t.subscriptions,a=[];for(o in i)s=i[o],a.push(function(r,o){var s,i,a;return a=e[o.url],a?(s=function(){var e,n,r;for(r=[],e=0,n=a.length;n>e;e++)i=a[e],r.push({From:"service@kra.vc",To:t.email,Subject:o.name,TextBody:""+i.title+"\n"+i.link});return r}(),n.appendArray(s)):void 0}(o,s));return a};for(t in s)r=s[t],o(t,r);return n},n}()}).call(this);