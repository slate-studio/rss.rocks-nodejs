(function(){var e,r,s,t,n;Array.prototype.unique=function(){var e,r,s,t,n,i;for(r={},e=t=0,n=this.length;n>=0?n>t:t>n;e=n>=0?++t:--t)r[this[e]]=this[e];i=[];for(e in r)s=r[e],i.push(s);return i},t=require("./parser"),e=require("./cacher"),n=require("./sender"),r=require("firebase"),module.exports=s=function(){function s(){this.firebaseAppName="rss-rocks",this.firebaseRef=new r("https://"+this.firebaseAppName+".firebaseio.com"),this.usersRef=this.firebaseRef.child("users")}return s.prototype.start=function(){return this.usersRef.on("value",function(e){return function(r){return e.usersRef.off(),e.users=r.val(),e.pullFeedsOutOfSubscriptions(),e.sendEmailsWithNewPosts()}}(this))},s.prototype.pullFeedsOutOfSubscriptions=function(){var e,r,s,t,n;e=[],n=this.users,t=function(r,s){var t,n,i;return i=function(){var e,r;e=s.subscriptions,r=[];for(t in e)n=e[t],r.push(n.url);return r}(),Array.prototype.push.apply(e,i)};for(s in n)r=n[s],t(s,r);return this.feeds=e.unique()},s.prototype.sendEmailsWithNewPosts=function(){return new t(this.feeds,function(r){return function(s){return new e(r.firebaseRef,s,function(e){return new n(r.usersRef,e,function(){return console.log("done"),process.exit()})})}}(this))},s}()}).call(this);